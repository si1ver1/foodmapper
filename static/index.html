<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Tracker</title>
    <!-- Tailwind CSS -->
    <!-- Compiled Tailwind CSS -->
    <link href="/static/css/output.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom scrollbar for dark mode aesthetics */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-default::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar-default::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .scrollbar-default::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* Marker Bounce Animation using transform (requires wrapper) */
        @keyframes markerBounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        .marker-bounce {
            animation: markerBounce 0.5s infinite ease-in-out;
        }

        .dark .scrollbar-default::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .dark .scrollbar-default::-webkit-scrollbar-thumb {
            background: #4a4a4a;
        }

        /* Dark Map Filter - Midnight Blue */
        .dark-map-tiles {
            filter: invert(100%) hue-rotate(210deg) brightness(95%) contrast(100%) saturate(140%);
        }

        /* Toggle Switch Fallback */
        .toggle-publish:checked~.toggle-bg {
            background-color: #2563eb;
        }

        .toggle-publish:checked~.dot {
            transform: translateX(100%);
        }
    </style>
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#2563eb">
</head>

<body
    class="bg-gray-100 dark:bg-darkbg text-gray-800 dark:text-gray-100 transition-colors duration-200 h-[100dvh] overflow-hidden flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white dark:bg-darkcard shadow-md z-20 px-4 py-3 flex justify-between items-center shrink-0">
        <h1 class="text-xl font-bold tracking-tight text-blue-600 dark:text-blue-400">
            <i class="fa-solid fa-map-location-dot mr-2"></i>FoodMapper
        </h1>
        <div class="flex items-center space-x-4">
            <button id="add-btn"
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm">
                <i class="fa-solid fa-plus mr-1"></i> Add Restaurant
            </button>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                <i class="fa-solid fa-moon dark:hidden"></i>
                <i class="fa-solid fa-sun hidden dark:inline text-yellow-400"></i>
            </button>
            <span id="user-display" class="text-sm font-medium text-gray-600 dark:text-gray-300 mr-2 hidden"></span>
            <button id="login-btn" title="Login"
                class="text-blue-600 dark:text-blue-400 font-medium hover:underline transition hidden">
                Login
            </button>
            <button id="logout-btn" title="Logout" class="text-gray-500 hover:text-red-500 transition">
                <i class="fa-solid fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>

    <!-- Filters Bar (Mobile/Desktop friendly) -->
    <div
        class="bg-white dark:bg-darkcard border-b border-gray-200 dark:border-gray-700 px-4 py-2 flex gap-2 overflow-x-auto scrollbar-hide shrink-0 z-10 items-center">
        <!-- Local Search -->
        <div class="relative shrink-0">
            <i class="fa-solid fa-search absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs"></i>
            <input type="text" id="filter-search" placeholder="Search..."
                class="pl-7 pr-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 w-32 focus:w-48 transition-all">
        </div>

        <button id="btn-help-choose"
            class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-full text-sm font-bold shadow-md transition whitespace-nowrap flex items-center gap-1 shrink-0">
            <i class="fa-solid fa-wand-magic-sparkles"></i> Help Me Choose
        </button>
        <div class="w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1 shrink-0"></div>
        <div class="flex items-center gap-1">
            <select id="filter-cuisine"
                class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded-l px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Cuisines</option>
                <!-- Populated dynamically -->
            </select>
            <button id="btn-manage-cuisines" title="Manage Cuisines"
                class="bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 rounded-r px-2 py-1 text-sm transition">
                <i class="fa-solid fa-cog"></i>
            </button>
        </div>
        <select id="filter-rating"
            class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">All Ratings</option>
            <option value="5">5 Stars</option>
            <option value="4">4+ Stars</option>
            <option value="3">3+ Stars</option>
        </select>
        <select id="filter-price"
            class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">All Prices</option>
            <option value="$">$</option>
            <option value="$$">$$</option>
            <option value="$$$">$$$</option>
            <option value="$$$$">$$$$</option>
        </select>
        <select id="filter-status"
            class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">All Statuses</option>
            <option value="Want to go">Want to go</option>
            <option value="Visited">Visited</option>
            <option value="Favorite">Favorite</option>
        </select>
        </select>
        <div class="flex items-center gap-1">
            <select id="filter-group"
                class="bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 rounded-l px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Groups</option>
                <!-- Populated dynamically -->
            </select>
            <button id="btn-manage-groups" title="Manage Groups"
                class="bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 rounded-r px-2 py-1 text-sm transition">
                <i class="fa-solid fa-list-ul"></i>
            </button>
        </div>
    </div>

    <!-- Main Content (Split Screen) -->
    <div class="flex-1 flex overflow-hidden relative">

        <!-- Mobile Tabs (Visible only on small screens) -->
        <div
            class="md:hidden absolute bottom-0 left-0 right-0 bg-white dark:bg-darkcard border-t dark:border-gray-700 flex z-30 pb-5">
            <button id="tab-list"
                class="flex-1 py-3 text-center text-blue-600 dark:text-blue-400 font-medium border-t-2 border-blue-600">List</button>
            <button id="tab-map"
                class="flex-1 py-3 text-center text-gray-500 dark:text-gray-400 font-medium">Map</button>
        </div>

        <!-- Left Sidebar (List) -->
        <div id="list-view"
            class="w-full md:w-1/3 lg:w-1/4 bg-white dark:bg-darkcard border-r border-gray-200 dark:border-gray-700 overflow-y-auto scrollbar-default pb-16 md:pb-0 z-10">
            <div id="restaurant-list" class="p-4 space-y-4">
                <!-- Restaurant Cards populate here -->
                <div class="text-center text-gray-500 mt-10">Loading...</div>
            </div>
        </div>

        <!-- Right Main Area (Map) -->
        <div id="map-view" class="w-full md:w-2/3 lg:w-3/4 bg-gray-200 relative hidden md:block h-full">
            <div id="map" class="absolute inset-0 h-full w-full z-0"></div>
        </div>
    </div>

    <!-- Add Restaurant Modal -->
    <div id="modal-overlay"
        class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-darkcard rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto transform transition-all scale-95 opacity-0 modal-anim">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modal-title" class="text-2xl font-bold text-gray-900 dark:text-gray-100">Add Restaurant</h2>
                    <button id="modal-close" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>

                <form id="add-form" class="space-y-4">
                    <!-- Smart Search -->
                    <div class="relative">
                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Search Place
                            (Google)</label>
                        <div class="flex gap-2" id="search-container">
                            <input type="text" id="search-input" placeholder="Type name or address..."
                                class="flex-1 p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 outline-none">
                            <button type="button" id="search-btn"
                                class="bg-blue-600 text-white px-3 id='search-btn' rounded hover:bg-blue-700">
                                <i class="fa-solid fa-search"></i>
                            </button>
                        </div>
                        <ul id="search-results"
                            class="absolute z-50 w-full bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-lg mt-1 rounded max-h-48 overflow-y-auto hidden">
                        </ul>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Name</label>
                            <input type="text" id="form-name" required
                                class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label
                                class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Cuisines</label>
                            <div id="form-cuisines-container"
                                class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
                                <!-- Populated dynamically -->
                            </div>
                            <div class="flex items-center gap-2 mt-1">
                                <button type="button" id="toggle-new-cuisine"
                                    class="text-xs text-blue-500 hover:underline">Add New</button>
                                <input type="text" id="form-cuisine-new" placeholder="New Type..."
                                    class="hidden w-full text-xs p-1 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Groups /
                                Lists</label>
                            <div id="form-groups-container"
                                class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-32 overflow-y-auto p-2 border rounded dark:bg-gray-800 dark:border-gray-600">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Address</label>
                        <input type="text" id="form-address" required
                            class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Rating
                                (1-5)</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="form-rating" min="1" max="5" value="3"
                                    class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                                <label class="flex items-center gap-1 text-xs whitespace-nowrap">
                                    <input type="checkbox" id="form-rating-none"> None
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Price</label>
                            <select id="form-price"
                                class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                                <option value="$">$</option>
                                <option value="$$">$$</option>
                                <option value="$$$">$$$</option>
                                <option value="$$$$">$$$$</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Lat</label>
                            <input type="number" step="any" id="form-lat" required readonly
                                class="w-full p-2 border rounded bg-gray-100 dark:bg-gray-700 dark:text-gray-100 cursor-not-allowed">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Long</label>
                            <input type="number" step="any" id="form-lng" required readonly
                                class="w-full p-2 border rounded bg-gray-100 dark:bg-gray-700 dark:text-gray-100 cursor-not-allowed">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Status</label>
                        <select id="form-status"
                            class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                            <option value="Want to go">Want to go</option>
                            <option value="Visited">Visited</option>
                            <option value="Favorite">Favorite</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Notes</label>
                        <textarea id="form-notes" rows="2"
                            class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100"></textarea>
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg shadow-md transition transform hover:scale-[1.01]">
                        Save Restaurant
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Help Me Choose Modal -->
    <div id="modal-choose"
        class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-darkcard rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all scale-95 opacity-0 modal-anim flex flex-col">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2"><i
                            class="fa-solid fa-wand-magic-sparkles text-purple-600"></i> Help Me Choose</h2>
                    <button id="modal-choose-close" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fa-solid fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Step 1: Filters -->
                <div id="choose-step-1" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Cuisines (Select any)</label>
                        <div id="choose-cuisines"
                            class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-40 overflow-y-auto p-2 border rounded dark:border-gray-700">
                            <!-- Helper Checkboxes -->
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Min Price</label>
                            <select id="choose-price"
                                class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                                <option value="">Any Price</option>
                                <option value="$">$ (Cheap)</option>
                                <option value="$$">$$ (Moderate)</option>
                                <option value="$$$">$$$ (Expensive)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Min Rating</label>
                            <select id="choose-rating"
                                class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 text-gray-900 dark:text-gray-100">
                                <option value="">Any Rating</option>
                                <option value="3">3+ Stars</option>
                                <option value="4">4+ Stars</option>
                                <option value="5">5 Stars</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Status</label>
                            <div class="space-y-1">
                                <label class="flex items-center gap-2"><input type="checkbox" class="choose-status"
                                        value="Want to go" checked> Want to go</label>
                                <label class="flex items-center gap-2"><input type="checkbox" class="choose-status"
                                        value="Favorite" checked> Favorite</label>
                                <label class="flex items-center gap-2"><input type="checkbox" class="choose-status"
                                        value="Visited" checked> Visited</label>
                            </div>
                        </div>
                    </div>

                    <button id="btn-choose-go"
                        class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg shadow-md transition transform hover:scale-[1.01] flex justify-center items-center gap-2 text-lg">
                        <i class="fa-solid fa-dice"></i> Find Me Food!
                    </button>
                </div>

                <!-- Step 2: Results -->
                <div id="choose-step-2" class="hidden space-y-4">
                    <button id="btn-choose-back"
                        class="text-sm text-gray-500 hover:text-gray-700 mb-2 no-underline hover:underline">
                        &larr; Back to filters
                    </button>
                    <div id="choose-results-list" class="space-y-3">
                        <!-- Result cards -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Cuisines Modal -->
    <div id="modal-cuisines"
        class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-darkcard rounded-xl shadow-xl w-full max-w-sm max-h-[80vh] overflow-hidden transform transition-all scale-95 opacity-0 modal-anim flex flex-col">
            <div class="p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="font-bold text-lg text-gray-900 dark:text-gray-100">Manage Cuisines</h3>
                <button id="modal-cuisines-close" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="p-0 overflow-y-auto flex-1">
                <ul id="manage-cuisines-list" class="divide-y divide-gray-100 dark:divide-gray-700">
                    <!-- List items -->
                </ul>
            </div>
            <div class="p-3 bg-gray-50 dark:bg-gray-800 text-xs text-gray-500 text-center">
                Cannot delete cuisines used by restaurants.
            </div>
        </div>
    </div>

    <!-- Modal: Manage Groups -->
    <div id="modal-groups"
        class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div
            class="bg-white dark:bg-darkcard rounded-xl shadow-2xl w-full max-w-sm max-h-[80vh] overflow-y-auto transform transition-all scale-95 opacity-0 modal-anim">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold dark:text-gray-100">Manage Groups</h2>
                    <button id="modal-groups-close" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="mb-4 flex gap-2">
                    <input type="text" id="manage-group-input" placeholder="New Group Name"
                        class="flex-1 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100 text-sm">
                    <button id="manage-group-add"
                        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">Add</button>
                </div>
                <ul id="manage-groups-list" class="divide-y divide-gray-100 dark:divide-gray-700">
                    <!-- Populated dynamically -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="/static/js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed: ', err));
            });
        }
    </script>
</body>

</html>